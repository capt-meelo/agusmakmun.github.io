---
layout: post
title:  "[Backdoor 101] Backdooring PE File by Adding New Section Header"
date:   2018-07-16
categories: [osceprep]
---

## Introduction

In this post, I’m going to discuss how to inject a shellcode in an executable file. I’m also going to discuss the problem that I encountered along the way, and the solution that I came up with. 


The executable file that I’m going to backdoor is Putty v0.66 which can be downloaded [here](https://www.chiark.greenend.org.uk/~sgtatham/putty/releases/0.66.html).


Before anything else, let’s first discuss what a code cave is. According to [Wikipedia](https://en.wikipedia.org/wiki/Code_cave):
> _A **code cave** is a series of null bytes in a process's memory. The code cave inside a process's memory is often a reference to a section of the code’s script functions that have capacity for the injection of custom instructions. For example, if a script’s memory allows for 5 bytes and only 3 bytes are used, then the remaining 2 bytes can be used to add external code to the script._


If you want to learn more about code cave, this [article](https://www.codeproject.com/Articles/20240/The-Beginners-Guide-to-Codecaves) provides a good insight about it. I highly recommend that you read it. :thumbsup:  

## Program’s Execution Flow
The following diagram shows the execution flow of the executable file, before and after the modification. As you can see, we will create a code cave by inserting a new section header to the executable file, and redirect the program’s execution flow to it. Once the shellcode in our code cave is executed, we will jump back to the original code that was meant to be executed by the program, and continue the execution as if nothing changes.
![Program Flow](/static/img/08/01.png)
