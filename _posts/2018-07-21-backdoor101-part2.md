---
layout: post
title:  "[Backdoor 101] Backdooring PE File w/ User Interaction & Custom Encoder Using Existing Code Cave"
date:   2018-07-21
categories: [exploitdev, osceprep]
---

## Introduction

In the [previous post](https://capt-meelo.github.io/exploitdev/osceprep/2018/07/16/backdoor101-part1.html), we backdoored a PE file by adding a new section (code cave) to the executable file. However, we encountered the following problems:

1. Putty won’t run until the shell has made a connection to our attacking machine.
2. We had a bad detection rate of **31/66**. 

In this post, we’ll try to fixe those issues. As we saw before, simply adding a section header to an executable causes the detection rate to go up. To avoid this, we’ll use a code cave which already exists in the PE file. 

To resolve the issue with Putty’s execution, what we’re going to do is to trigger the shell upon user interaction. Specifically, the shell will be triggered once the victim tries to connect to an SSH server, by providing a valid IP address/host and clicking the _**Open**_ button. 

Again, we’ll use the same version of Putty which is v0.66. This version can be downloaded [here](https://www.chiark.greenend.org.uk/~sgtatham/putty/releases/0.66.html).  Before we start, let’s see the detection rate of the newly download Putty executable. **1/67** is pretty good. 
![Detect1](/static/img/09/01.png)
